<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>详情页</title>
		<link rel="SHORTCUT ICON" href="/shopping/chenchen.ico">
		<link rel="stylesheet" type="text/css" href="/shopping/css/shopping_common.css"/>
		<link rel="stylesheet" type="text/css" href="/shopping/user/page_goods/css/goods_common.css"/>
		<link rel="stylesheet" type="text/css" href="/shopping/user/page_goods/css/detail.css"/>
	</head>
	<body>
		<div class="page">

			<div class="top">
				<div class="top_inner">
					<div class="ti_left">
						<span>欢迎光临本站！</span>
						
						
						<!--  下面的也要ajax生成，因为goods_id要拿到  -->
						<a href="/shopping/user/page_user/login.html?loginfrom=page_goods/detail.html?goods_id=">请登录</a>&nbsp;
						<a href="/shopping/user/page_user/register.html?loginfrom=page_goods/detail.html?goods_id=">免费注册</a>
					</div>
					<div class="ti_center">
						<a href="#">adv</a>
					</div>
					<div class="ti_right">
						<a href="/shopping/user/page_user/center_orderlist.html">我的订单</a>&nbsp;
						<a href="/shopping/user/page_user/center.html">用户中心</a>&nbsp;
						<a href="/shopping/admin/login.html">管理员登录</a>&nbsp;
					</div>
					<div class="clear"></div>
				</div>
			</div>

			<div class="space20px"></div>
			<div class="head">
				<div class="head_inner">
					<div class="hi_logo">
						<a href="/shopping/user/page_goods/index.html">网站LOGO</a>
					</div>
					<div class="hi_search">
						<form action="#" method="get">
							<input type="text" name="search_key" class="search_key"/>
							<input type="submit" value="搜索" class="search_submit" />
						</form>
					</div>
					<div class="hi_cartbtn">
						<a href="/shopping/user/page_cart/cart.html" class="hic_cartbtn">购物车</a>
					</div>
					<div class="clear"></div>
				</div>
			</div>
			<div class="space20px"></div>


			<div class="nav">
				<div class="nav_inner">
					<div class="ni_categorys">
						<a class="nic_btna" href="JavaScript:void(0);">全部商品分类</a>
						<div class="nic_block" style="display: none;">
							<ul>
								<li>
									<h6>分类一</h6>
									<p>
										<a href="#">关键字1</a>
										<a href="#">关键字1</a>
										<a href="#">关键字1</a>
									</p>
								</li>
								<li>
									<h6>分类一</h6>
									<p>
										<a href="#">关键字1</a>
										<a href="#">关键字1</a>
										<a href="#">关键字1</a>
									</p>
								</li>
								<li>
									<h6>分类一</h6>
									<p>
										<a href="#">关键字1</a>
										<a href="#">关键字1</a>
										<a href="#">关键字1</a>
									</p>
								</li>
								<li>
									<h6>分类一</h6>
									<p>
										<a href="#">关键字1</a>
										<a href="#">关键字1</a>
										<a href="#">关键字1</a>
									</p>
								</li>
							</ul>
						</div>
					</div>
					<div class="ni_activity">
						<a href="#">满百包邮</a>
						<a href="#">充值优惠</a>
						<a href="#">新会员专区</a>
						<a href="#">每日开团</a>
						<a href="#">新品预告</a>
					</div>
					<div class="clear"></div>
				</div>
			</div>
			
			
			<div class="space10px"></div>
			<div class="main">
				<div class="main_inner">
					<div class="mi_detailinfo">
						<div class="midi_left">
							<div class="midil_big">
								<a href="JavaScript:void(0);">
									<img src="/shopping/goodsImg/goods.jpg" class="midil_big_1"/>
								</a>
								<div class="clear space10px"></div>
							</div>
							<div class="midil_small">
								<a href="JavaScript:void(0);" class="midil_small_a_1">
									<img src="/shopping/goodsImg/goods.jpg" class="midil_small_1"/>
								</a>
								<a href="JavaScript:void(0);" class="midil_small_a_2">
									<img src="/shopping/goodsImg/goods.jpg" class="midil_small_2"/>
								</a>
								<a href="JavaScript:void(0);" class="midil_small_a_3">
									<img src="/shopping/goodsImg/goods.jpg" class="midil_small_3"/>
								</a>
								<a href="JavaScript:void(0);" class="midil_small_a_4">
									<img src="/shopping/goodsImg/goods.jpg" class="midil_small_4"/>
								</a>
								<a href="JavaScript:void(0);" class="midil_small_a_5">
									<img src="/shopping/goodsImg/goods.jpg" class="midil_small_5"/>
								</a>
								<div class="clear"></div>
							</div>
						</div>


						<div class="midi_right">
							<h1 class="midi_right_h1">【嘟嘟衣舍】韩国时尚前卫设计师最新力作潮的你哭不买就计师最新力作潮的你哭不买就后悔限量版</h1>
							<div class="space10px"></div>
							<p class="midir_desc">
								韩国时尚前卫设计师最新力作潮的你哭不买就计师最新力作潮的你哭不买就后悔限量版韩国时尚前卫设计师最新力作潮的你哭不买就计师最新力作潮的你哭不买就后悔限量版
							</p>
							<div class="space10px"></div>
							<div class="midir_price">
								<div class="midirt_left">价格</div>
								<div class="midirt_right">
									<strike>￥28.80</strike>&nbsp;&nbsp;
									<strong>￥18.00</strong>
								</div>
								<div class="clear"></div>
							</div>
							<div class="space10px"></div>
							<div class="midir_tabinfo">
								<div class="midirt_left">运费</div>
								<div class="midirt_right">包邮</div>
								<div class="clear"></div>
							</div>
							<div class="space10px"></div>
							<div class="midir_tabinfo">
								<div class="midirt_left">尺码</div>
								<div class="midirt_right">均码</div>
								<div class="clear"></div>
							</div>
							<div class="space10px"></div>
							<div class="midir_tabinfo">
								<div class="midirt_left">颜色</div>
								<div class="midirt_right">
									随机发货
								</div>
								<div class="clear"></div>
							</div>
							<div class="space10px"></div>
							<div class="midir_tabinfo">
								<div class="midirt_left">数量</div>
								<div class="midirt_right">
									<input class="midirtr_count" value="1"/>
									<div class="midirtr_operate">
										<a href="JavaScript:void(0);" class="plus">+</a>
										<a href="JavaScript:void(0);" class="sub">-</a>
										<div class="clear"></div>
									</div>
									<div class="clear"></div>
								</div>
								<div class="clear"></div>
							</div>
							<div class="space10px"></div>
							<div class="midir_tabinfo">
								<div class="midirt_left">库存</div>
								<div class="midirt_right goods_ttnum"><span>188</span>件</div>
								<div class="clear"></div>
							</div>
							<div class="space10px"></div>
							<div class="midir_tabinfo">
								<div class="midirt_left">&nbsp;</div>
								<div class="midirt_right">
									<a href="JavaScript:void(0);" class="midirtr_buynow">立即购买</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
									<a href="JavaScript:void(0);" class="midirtr_addcart">加入购物车</a>
								</div>
								<div class="clear"></div>
							</div>
							<div class="space10px"></div>
							<div class="midir_tabinfo">
								<div class="midirt_left">服务承诺</div>
								<div class="midirt_right midirt_serviceruler">
									<span>正品承诺</span>&nbsp;&nbsp;&nbsp;
									<span>按时发货</span>&nbsp;&nbsp;&nbsp;
									<span>极速退款</span>&nbsp;&nbsp;&nbsp;
									<span>七天无理由退换</span>
								</div>
								<div class="clear"></div>
							</div>
						</div>
						<div class="clear"></div>
					</div>
					<div class="clear space30px"></div>
					<div class="mi_detaildesc">
						<div class="mid_left">
							<h2>商家推荐TOP10</h2>
							<div class="midl_content">
								<div class="midlc_block">
									<dl>
										<dt>
											<a href="detail.html">
												<img src="/shopping/goodsImg/goods.jpg" />
											</a>
										</dt>
										<dd>
											<a href="detail.html">
												【嘟嘟衣舍】韩国时尚前卫设计师最新力作潮的你哭不买就计师最新力作潮的你哭不买就后悔限量版
											</a>
										</dd>
										<dd>
											<span>销量：<strong>98</strong>件</span>
											<span>价格：<b>￥98</b></span>
										</dd>
									</dl>
								</div>
								
								<div class="midlc_block">
									<dl>
										<dt>
											<a href="detail.html">
												<img src="/shopping/goodsImg/goods.jpg" />
											</a>
										</dt>
										<dd>
											<a href="detail.html">
												【嘟嘟衣舍】韩国时尚前卫设计师最新力作潮的你哭不买就计师最新力作潮的你哭不买就后悔限量版
											</a>
										</dd>
										<dd>
											<span>销量：<strong>98</strong>件</span>
											<span>价格：<b>￥98</b></span>
										</dd>
									</dl>
								</div>
							</div>
						</div>

						<div class="mid_right">
							<div class="midr_bar">
								<a href="JavaScript:void(0);">商品详情</a>
								<a href="JavaScript:void(0);">商品评价</a>
							</div>
							<div class="midr_content">
								<div class="midrc_evaluate">
									
									<div style="text-align: center;">
										<div class="space20px"></div>
										<span>暂无评论 ...</span>
										<div class="space20px"></div>
									</div>
									
									<div class="midrce_block">
										<div class="midrceb_left">
											<a href="#">
												<img src="/shopping/user/page_goods/img/user_default_header.png"/>
											</a><br />
											<span class="midrcebl_name">
												response****
											</span><br />
											<span class="midrcebl_name">
												VIP1
											</span>
										</div>
										<div class="midrceb_right">
											<div class="space20px"></div>
											<p>评论内容非常好吃推荐购买评论内容非常好吃推荐购买评论内容非常好吃推荐购买评论内容非常好吃推荐购买评论内容非常好吃推荐购买</p>
											<div class="space20px"></div>
											<p class="midrcebr_time">2015年09月09日 12:18</p>
											<div class="space10px"></div>
										</div>
										<div class="clear"></div>
									</div>
									
								</div>
								
								<div class="midrc_desc">
									<div>
										<div class="space20px"></div>
										<span>数据加载中 ...</span>
										<div class="space20px"></div>
									</div>
									<!--<img src="/shopping/goodsImg/goods.jpg"/>-->
								</div>
								
							</div>
						</div>
						<div class="clear"></div>
					</div>
				</div>
			</div>
			<div class="space10px"></div>
			
			
			
			
			<div class="foot">
				<div class="foot_inner">
					<div class="fi_public">
						<a href="#">关于我们</a>
						<span>&nbsp;|&nbsp;</span>
						<a href="#">投资者</a>
						<span>&nbsp;|&nbsp;</span>
						<a href="#">加入我们</a>
						<span>&nbsp;|&nbsp;</span>
						<a href="#">联系我们</a>
						<span>&nbsp;|&nbsp;</span>
						<a href="#">网站地图</a>
						<span>&nbsp;|&nbsp;</span>
						<a href="#">法律声明</a>
					</div>
					<div class="space20px"></div>
					<p class="fi_copy">(c) Copyright 2016 new. All Rights Reserved. </p>
				</div>
			</div>
		</div>
		
		<script src="/shopping/js/jQuery.1.8.3.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="/shopping/layer/layer.js" type="text/javascript" charset="utf-8"></script>
		<script src="/shopping/js/jquery.cookie.js" type="text/javascript" charset="utf-8"></script>
		<script src="/shopping/js/shopping_common.js" type="text/javascript" charset="utf-8"></script>
		<script src="/shopping/js/getcategoryandkeys.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
		//detail页面需要一个商品id来进入特定商品的页面，然后也要给登录，注册，登出三个页面传值，如果没登录就点购物车，还要给购物车页面传值
		
		$(function(){
			var user_name_cookie = $.cookie("user_name_cookie"); 
			var goods_ttnum = 0;
			var goods_id = "";
			var str = window.location.href.split("?")[1];
			if(str == undefined || str == "") {
				layer.alert('客官，小店没有您要查看的商品，马上帮您跳转到主页~~', {icon: 5},function(){
					window.location.href = "/shopping/user/page_goods/index.html";
				}); 
			} else {
				goods_id = str.split("=")[1];
				$.ajax({
					type:"post",
					url:"/shopping/user/addClickNum.do",
					data:{"goods_id":goods_id},
					success:function(msg){
						//alert("success");
					}
				});
				
				$.ajax({
					type:"post",
					url:"/shopping/user/getLogoAndCopyright.do",
					success:function(data){
						LogoAndCopyright_val = eval("("+data+")");
						$(".hi_logo a").attr("style","background: url(/img/"+LogoAndCopyright_val.logo_img+");");
						$(".fi_copy").text(LogoAndCopyright_val.copyright_detail);
					}
				});
				
				 if(user_name_cookie != undefined && user_name_cookie != "null") {
					$.ajax({
						type:"post",
						url:"/shopping/user/updateUserHistory.do",
						data:{"user_name":user_name_cookie,"goods_id":goods_id},
						success:function(msg){
							//alert("success");
						}
					});
				 }
				
				$.ajax({
					type:"post",
					url:"/shopping/user/getShopRecommendations.do",
					data:{"goods_id":goods_id},
					success:function(data){
						var shoprecommendation_goodsinfos = eval("("+data+")");
						var _html = "";
						for (var i = 0; i < shoprecommendation_goodsinfos.length; i++) {
							_html += "<div class='midlc_block'>"
							       + "<dl>"
							       + "<dt>"
								   + "<a href='/shopping/user/page_goods/detail.html?goods_id="+ shoprecommendation_goodsinfos[i].goods_id +"'>"
								   + "<img src='/shopping/goodsImg/"+shoprecommendation_goodsinfos[i].goods_img.split(",")[0]+"' />"
								   + "</a>"
							       + "</dt>"
							       + "<dd>"
								   + "<a href='/shopping/user/page_goods/detail.html?goods_id="+ shoprecommendation_goodsinfos[i].goods_id +"'>"+shoprecommendation_goodsinfos[i].goods_name+"</a>"
								   + "</dd><dd>"
								   + "<span>销量：<strong>"+shoprecommendation_goodsinfos[i].goods_soldnum+"</strong>件</span>"
								   + "<span>价格：<b>￥"+new Number(shoprecommendation_goodsinfos[i].goods_curprice).toFixed(2)+"</b></span>"
							       + "</dd>"
						           + "</dl>"
					               + "</div>"
						}
						$(".mi_detaildesc .mid_left .midl_content").html(_html);
					}
				});
			}
			
		
			
			
			//var user_id = "";
			//alert(user_name_cookie);
			
			if(user_name_cookie != undefined && user_name_cookie != "null") {
				$(".ti_left").html("<span>欢迎光临本站！</span><a href='/shopping/user/page_user/center.html'>"+user_name_cookie+"</a>&nbsp;<a href='JavaScript:void(0);' class='logout_btn' >退出登录</a>");
			}
			
			if(user_name_cookie == undefined || user_name_cookie == "null") {
				$(".ti_left").html("<span>欢迎光临本站！</span>"
						 + "<a href='/shopping/user/page_user/login.html?loginfrom=page_goods/index.html'>请登录</a>&nbsp;"
						 + "<a href='/shopping/user/page_user/register.html?regfrom=page_goods/index.html'>免费注册</a>");
			}
			
			$(".logout_btn").live("click", function(){
				$.cookie("user_name_cookie", null,{path: "/"});
				//$.removeCookie("user_name_cookie");
				$(".ti_left").html("<span>欢迎光临本站！</span>"
								 + "<a href='/shopping/user/page_user/login.html?loginfrom=page_goods/index.html'>请登录</a>&nbsp;"
								 + "<a href='/shopping/user/page_user/register.html?regfrom=page_goods/index.html'>免费注册</a>");
			});	
			/* 
			$.ajax({
				type:"post",
				url:"/shopping/user/getCatsAndKeys.do",
				success:function(data){
					var cats = eval("("+data+")");
					var _html = "";
					for (var i = 0; i < cats.length; i++) {
						//var keys = eval("("+cats[i].keys+")");
						//alert(keys[0].key_id);
						_html += "<li>"
							 + "<h6>"+ cats[i].cat_name +"</h6>"
							 + "<p>"
							 + "<a href='/shopping/user/page_goods/list_categray.html?cat_id="+cats[i].cat_id+"&key_id="+cats[i].keys[0].key_id+"'>"+cats[i].keys[0].key_name+"</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"
							 + "<a href='/shopping/user/page_goods/list_categray.html?cat_id="+cats[i].cat_id+"&key_id="+cats[i].keys[1].key_id+"'>"+cats[i].keys[1].key_name+"</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"
							 + "<a href='/shopping/user/page_goods/list_categray.html?cat_id="+cats[i].cat_id+"&key_id="+cats[i].keys[2].key_id+"'>"+cats[i].keys[2].key_name+"</a>"
							 + "</p>"
							 + "</li>";
					}
					$(".nic_block ul").html(_html);
				}
			}); */
			
			$.ajax({
				type:"post",
				url:"/shopping/user/getGoodsInfoAbove.do",
				data:{"goods_id":goods_id},
				success:function(data){
					if(data == "no goods_id") {
						layer.alert('客官，小店没有您要查看的商品，马上帮您跳转到主页~~', {icon: 5},function(){
							window.location.href = "/shopping/user/page_goods/index.html";
						});
					} else {
						var goodsinfo = eval("("+data+")");
						$(".midil_big img").attr("src","/shopping/goodsImg/"+goodsinfo.goods_img.split(",")[0]);
						$(".midil_small .midil_small_1").attr("src","/shopping/goodsImg/"+goodsinfo.goods_img.split(",")[0]);
						$(".midil_small .midil_small_2").attr("src","/shopping/goodsImg/"+goodsinfo.goods_img.split(",")[1]);
						$(".midil_small .midil_small_3").attr("src","/shopping/goodsImg/"+goodsinfo.goods_img.split(",")[2]);
						$(".midil_small .midil_small_4").attr("src","/shopping/goodsImg/"+goodsinfo.goods_img.split(",")[3]);
						$(".midil_small .midil_small_5").attr("src","/shopping/goodsImg/"+goodsinfo.goods_img.split(",")[4]);
						$(".midi_right .midi_right_h1").html(goodsinfo.goods_name);
						$(".midi_right .midir_desc").html(goodsinfo.goods_info);
						$(".midi_right .midir_price .midirt_right").html("<strike>￥"+ new Number(goodsinfo.goods_oriprice).toFixed(2) +"</strike>&nbsp;&nbsp;"
																	   + "<strong>￥"+ new Number(goodsinfo.goods_curprice).toFixed(2) +"</strong>");
						if(goodsinfo.goods_ttnum > 0) {
							$(".goods_ttnum").html("<span>"+goodsinfo.goods_ttnum+"</span>件");
						} else {
							$(".goods_ttnum").html("<span>库存不足，请购买其他商品！</span>");
							//这里是如果商品库存为0的话显示的内容，下面的CSS还没有测试对，但是上面设置库存信息不对。。。
							$(".midirtr_buynow").css({"background":"lightgrey"});
							$(".midirtr_addcart").css({"background":"lightgrey"});
							
						}
						goods_ttnum = goodsinfo.goods_ttnum;
						
						
					}
					
				}
			});
			
			$(".logout_btn").on("click", function(){
				$.cookie("user_name_cookie", null,{path: "/"});
				location.reload();
				//$.removeCookie("user_name_cookie");
				$(".ti_left").html("<span>欢迎光临本站！</span>"
								 + "<a href='/shopping/user/page_user/login.html?loginfrom=page_goods/index.html'>请登录</a>&nbsp;"
								 + "<a href='/shopping/user/page_user/register.html?regfrom=page_goods/index.html'>免费注册</a>");
			});
			
			$(".midil_small .midil_small_1").mouseover(function(){
				var img_src_val = $(".midil_small .midil_small_1").attr("src");
				$(".midil_big .midil_big_1").attr("src",img_src_val);
			});
			$(".midil_small .midil_small_2").mouseover(function(){
				var img_src_val = $(".midil_small .midil_small_2").attr("src");
				$(".midil_big .midil_big_1").attr("src",img_src_val);
			});
			$(".midil_small .midil_small_3").mouseover(function(){
				var img_src_val = $(".midil_small .midil_small_3").attr("src");
				$(".midil_big .midil_big_1").attr("src",img_src_val);
			});
			$(".midil_small .midil_small_4").mouseover(function(){
				var img_src_val = $(".midil_small .midil_small_4").attr("src");
				$(".midil_big .midil_big_1").attr("src",img_src_val);
			});
			$(".midil_small .midil_small_5").mouseover(function(){
				var img_src_val = $(".midil_small .midil_small_5").attr("src");
				$(".midil_big .midil_big_1").attr("src",img_src_val);
			});
			
			$(".midirtr_operate .plus").click(function(){
				if(goods_ttnum < 1) {
					layer.alert('客官抱歉！该商品库存不足，请购买其他商品~~', {icon: 5});
				} else {
					var goods_count = parseInt($(".midirt_right .midirtr_count").val());
					
					goods_count += 1;
					if(goods_count > goods_ttnum) {
						layer.alert('客官抱歉！小店库存不足，请不要一次买这么多~~', {icon: 5});
					} else {
						$(".midirt_right .midirtr_count").val(goods_count);
					}
				}
			});
			
			$(".midirtr_operate .sub").click(function(){
				if(goods_ttnum < 1) {
					layer.alert('客官抱歉！该商品库存不足，请购买其他商品~~', {icon: 5});
				} else {
					var goods_count = parseInt($(".midirt_right .midirtr_count").val());
					goods_count -= 1;
					if(goods_count < 1) {
						layer.alert('客官，来都来了，一件都不买真的好嘛~~', {icon: 5});
					} else {
						$(".midirt_right .midirtr_count").val(goods_count);
					}
				}
			});
			
			$(".midirt_right .midirtr_count").blur(function(){
				if(goods_ttnum < 1) {
					layer.alert('客官抱歉！该商品库存不足，请购买其他商品~~', {icon: 5});
				} else {
					var goods_count = parseInt($(".midirt_right .midirtr_count").val());
					if(goods_count > goods_ttnum) {
						layer.alert('客官抱歉！小店库存不足，请不要一次买这么多~~', {icon: 5});
						$(".midirt_right .midirtr_count").val(goods_ttnum);
					} else if(goods_count < 1) {
						layer.alert('客官，来都来了，一件都不买真的好嘛~~', {icon: 5});
						$(".midirt_right .midirtr_count").val(1);
					}
				}
			});
			
			$(".midirtr_addcart").click(function(){
				if(goods_ttnum < 1) {
					layer.alert('客官抱歉！该商品库存不足，请购买其他商品~~', {icon: 5});
				} else {
					var goods_count = parseInt($(".midirt_right .midirtr_count").val());
					if(user_name_cookie == undefined || user_name_cookie == "null") {
						layer.alert('客官，必须要登录才能添加到购物车~~', {icon: 5});
					} else if(goods_count > goods_ttnum) {
						layer.alert('客官抱歉！小店库存不足，请不要一次买这么多~~', {icon: 5});
						$(".midirt_right .midirtr_count").val(goods_ttnum);
					} else if(goods_count < 1) {
						layer.alert('客官，来都来了，一件都不买真的好嘛~~', {icon: 5});
						$(".midirt_right .midirtr_count").val(1);
					} else {
						var flag = "cart_false";
						$.ajax({
							type:"post",
							url:"/shopping/user/addCartAndRemoveCart.do",
							data:{"flag":flag,"goods_id":goods_id,"user_name":user_name_cookie,"goods_num":goods_count},
							async:false,
							success:function(msg){
								if(msg == "already_exist") {
									layer.alert('客官，该商品已经存在于您的购物车，即将帮您跳转到购物车页面~~', {icon: 5},function(){
										window.location.href = "/shopping/user/page_cart/cart.html";
									});
								} else if(msg == "add_cart"){
									layer.msg("客官，该商品已经成功加入您的购物车，请前往购物车页面查看~~"); 
								}
							}
						});
					}
				}
			});
			
		});
		</script>
	</body>
</html>
