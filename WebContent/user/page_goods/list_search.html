<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>搜索列表页</title>
		<link rel="SHORTCUT ICON" href="/shopping/chenchen.ico">
		<link rel="stylesheet" type="text/css" href="/shopping/css/shopping_common.css"/>
		<link rel="stylesheet" type="text/css" href="/shopping/user/page_goods/css/goods_common.css"/>
		<link rel="stylesheet" type="text/css" href="/shopping/user/page_goods/css/list_category.css"/>
	</head>
	<body>
		<div class="page">

			<div class="top">
				<div class="top_inner">
					<div class="ti_left">
						<span>欢迎光临本站！</span>
						<a href="/shopping/user/page_user/login.html?loginfrom=page_goods/index.html">请登录</a>&nbsp;
						<a href="/shopping/user/page_user/register.html?regfrom=page_goods/index.html">免费注册</a>
					</div>
					<div class="ti_center">
						<a href="#">adv</a>
					</div>
					<div class="ti_right">
						<a href="/shopping/user/page_user/center_orderlist.html">我的订单</a>&nbsp;
						<a href="/shopping/user/page_user/center.html">用户中心</a>&nbsp;
						<a href="/shopping/admin/login.html">管理员登录</a>&nbsp;
					</div>
					<div class="clear"></div>
				</div>
			</div>

			<div class="space20px"></div>
			<div class="head">
				<div class="head_inner">
					<div class="hi_logo">
						<a href="/shopping/user/page_goods/index.html">网站LOGO</a>
					</div>
					<div class="hi_search">
						<form action="/shopping/user/page_goods/list_search.html" method="get">
							<input type="text" name="search_key" class="search_key"/>
							<input type="submit" value="搜索" class="search_submit" />
						</form>
					</div>
					<div class="hi_cartbtn">
						<a href="/shopping/user/page_cart/cart.html" class="hic_cartbtn">购物车</a>
					</div>
					<div class="clear"></div>
				</div>
			</div>
			<div class="space20px"></div>


			<div class="nav">
				<div class="nav_inner">
					<div class="ni_categorys">
						<a class="nic_btna" href="JavaScript:void(0);">全部商品分类</a>
						<div class="nic_block" style="display: none;">
							<ul>
								<li>
									<h6>分类一</h6>
									<p>
										<a href="#">关键字1</a>
										<a href="#">关键字1</a>
										<a href="#">关键字1</a>
									</p>
								</li>
								<li>
									<h6>分类一</h6>
									<p>
										<a href="#">关键字1</a>
										<a href="#">关键字1</a>
										<a href="#">关键字1</a>
									</p>
								</li>
								<li>
									<h6>分类一</h6>
									<p>
										<a href="#">关键字1</a>
										<a href="#">关键字1</a>
										<a href="#">关键字1</a>
									</p>
								</li>
								<li>
									<h6>分类一</h6>
									<p>
										<a href="#">关键字1</a>
										<a href="#">关键字1</a>
										<a href="#">关键字1</a>
									</p>
								</li>
							</ul>
						</div>
					</div>
					<div class="ni_activity">
						<a href="#">满百包邮</a>
						<a href="#">充值优惠</a>
						<a href="#">新会员专区</a>
						<a href="#">每日开团</a>
						<a href="#">新品预告</a>
					</div>
					<div class="clear"></div>
				</div>
			</div>
			
			<div class="space10px"></div>
			<div class="main">
				<div class="main_inner">
					<div class="mi_categray">
						<table width="100%" border="0" cellpadding="0" cellspacing="1">
							<tr>
								<th>主分类</th>
								<td>
									<a href="JavaScript:void(0);" class="a_active">主分类</a>
									<a href="JavaScript:void(0);">主分类</a>
									<a href="JavaScript:void(0);">主分类</a>
									<a href="JavaScript:void(0);">主分类</a>
								</td>
							</tr>
							<tr>
								<th>次分类</th>
								<td class="level2">
									<a href="JavaScript:void(0);">子分类1</a>
									<a href="JavaScript:void(0);" class="a_active">子分类1</a>
									<a href="JavaScript:void(0);">子分类1</a>
									<a href="JavaScript:void(0);">子分类1</a>
									<a href="JavaScript:void(0);">子分类1</a>
									<a href="JavaScript:void(0);">子分类1</a>
								</td>
							</tr>
						</table>
					</div>
					<div class="space20px"></div>
					<div class="mi_sort">
						<span class="mis_label"><b>排序</b></span>
						<span>
							<a href="JavaScript:void(0);">销量↑</a>
							<a href="JavaScript:void(0);">销量↓</a>
							&nbsp;
							<a href="JavaScript:void(0);">人气↑</a>
							<a href="JavaScript:void(0);">人气↓</a>
							&nbsp;
							<a href="JavaScript:void(0);">评价↑</a>
							<a href="JavaScript:void(0);">评价↓</a>
							&nbsp;
							<a href="JavaScript:void(0);">价格↑</a>
							<a href="JavaScript:void(0);">价格↓</a>
						</span>
					</div>
					<div class="space20px"></div>
					<div class="mi_list">
						<div class="mifc_block">
							<dl>
								<dt>
									<a href="#">
										<img src="../../goodsImg/goods.jpg"/>
									</a>
								</dt>
								<dd>
									<a href="#">韩国时尚前卫设计师最新力作潮的你哭不买就后悔限量版</a>
								</dd>
								<dd>
									<span>已售：<b>1689</b>件</span>&nbsp;&nbsp;&nbsp;
									<span>评价：<strong>1189</strong>次</span>
								</dd>
								<dd>
									<a href="#" class="mifcb_collect_btn">收藏</a>&nbsp;&nbsp;
									<a href="#" class="mifcb_addtocart_btn">加入购物车</a>
									<div class="space10px"></div>
								</dd>
							</dl>
						</div>
						
						<div class="mifc_block">
							<dl>
								<dt>
									<a href="#">
										<img src="../../goodsImg/goods.jpg"/>
									</a>
								</dt>
								<dd>
									<a href="#">韩国时尚前卫设计师最新力作潮的你哭不买就后悔限量版</a>
								</dd>
								<dd>
									<span>已售：<b>1689</b>件</span>&nbsp;&nbsp;&nbsp;
									<span>评价：<strong>1189</strong>次</span>
								</dd>
								<dd>
									<a href="#" class="mifcb_collect_btn">收藏</a>&nbsp;&nbsp;
									<a href="#" class="mifcb_addtocart_btn">加入购物车</a>
									<div class="space10px"></div>
								</dd>
							</dl>
						</div>
						
						<div class="mifc_block">
							<dl>
								<dt>
									<a href="#">
										<img src="../../goodsImg/goods.jpg"/>
									</a>
								</dt>
								<dd>
									<a href="#">韩国时尚前卫设计师最新力作潮的你哭不买就后悔限量版</a>
								</dd>
								<dd>
									<span>已售：<b>1689</b>件</span>&nbsp;&nbsp;&nbsp;
									<span>评价：<strong>1189</strong>次</span>
								</dd>
								<dd>
									<a href="#" class="mifcb_collect_btn">收藏</a>&nbsp;&nbsp;
									<a href="#" class="mifcb_addtocart_btn">加入购物车</a>
									<div class="space10px"></div>
								</dd>
							</dl>
						</div>
						
						<div class="mifc_block">
							<dl>
								<dt>
									<a href="#">
										<img src="../../goodsImg/goods.jpg"/>
									</a>
								</dt>
								<dd>
									<a href="#">韩国时尚前卫设计师最新力作潮的你哭不买就后悔限量版</a>
								</dd>
								<dd>
									<span>已售：<b>1689</b>件</span>&nbsp;&nbsp;&nbsp;
									<span>评价：<strong>1189</strong>次</span>
								</dd>
								<dd>
									<a href="#" class="mifcb_collect_btn">收藏</a>&nbsp;&nbsp;
									<a href="#" class="mifcb_addtocart_btn">加入购物车</a>
									<div class="space10px"></div>
								</dd>
							</dl>
						</div>
						
						<div class="mifc_block">
							<dl>
								<dt>
									<a href="#">
										<img src="../../goodsImg/goods.jpg"/>
									</a>
								</dt>
								<dd>
									<a href="#">韩国时尚前卫设计师最新力作潮的你哭不买就后悔限量版</a>
								</dd>
								<dd>
									<span>已售：<b>1689</b>件</span>&nbsp;&nbsp;&nbsp;
									<span>评价：<strong>1189</strong>次</span>
								</dd>
								<dd>
									<a href="#" class="mifcb_collect_btn">收藏</a>&nbsp;&nbsp;
									<a href="#" class="mifcb_addtocart_btn">加入购物车</a>
									<div class="space10px"></div>
								</dd>
							</dl>
						</div>
						
						<div class="clear"></div>
					</div>
				</div>
			</div>
			<div class="space10px"></div>
			
			
			
			
			<div class="foot">
				<div class="foot_inner">
					<div class="fi_public">
						<a href="#">关于我们</a>
						<span>&nbsp;|&nbsp;</span>
						<a href="#">投资者</a>
						<span>&nbsp;|&nbsp;</span>
						<a href="#">加入我们</a>
						<span>&nbsp;|&nbsp;</span>
						<a href="#">联系我们</a>
						<span>&nbsp;|&nbsp;</span>
						<a href="#">网站地图</a>
						<span>&nbsp;|&nbsp;</span>
						<a href="#">法律声明</a>
					</div>
					<div class="space20px"></div>
					<p class="fi_copy">(c) Copyright 2016 new. All Rights Reserved. </p>
				</div>
			</div>
		</div>
		
		<script src="/shopping/js/jQuery.1.8.3.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="/shopping/layer/layer.js" type="text/javascript" charset="utf-8"></script>
		<script src="/shopping/js/jquery.cookie.js" type="text/javascript" charset="utf-8"></script>
		<script src="/shopping/js/jquerysession.js" type="text/javascript" charset="utf-8"></script>
		<script src="/shopping/js/shopping_common.js" type="text/javascript" charset="utf-8"></script>
		<script src="/shopping/js/getcategoryandkeys.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
		$(document).ready(function(){
			var user_name_cookie = $.cookie("user_name_cookie"); 
			var user_search_goodsinfo_choices; 
			var collectiongoods_id = "";
			var cartgoods_id = "";
			var category_id_val = "";
			var keyword_id_val = "";
			var search_key_original_val = ""; //没有经过解码的搜索Key
			var search_key_val = ""; //经过解码的搜索key
			//alert(window.location.href.indexOf("search_key"));
			if(window.location.href.indexOf("search_key") == -1 || window.location.href.split("?")[1].split("&")[0].split("=")[1] == "") {
				window.location.href="/shopping/user/page_goods/list_categray.html";
			} else {
				search_key_original_val = window.location.href.split("?")[1].split("&")[0].split("=")[1];
				search_key_val = decodeURI(search_key_original_val);
				$(".search_key").val(search_key_val);
				//alert(window.location.href.split("?")[1].split("&")[0].split("=")[1]);
				//alert(search_key_original_val);
			}
			if(window.location.href.indexOf("cat_id") != -1) {
				category_id_val = window.location.href.split("?")[1].split("&")[1].split("=")[1];
				//alert(category_id_val);
			}
			if(window.location.href.indexOf("key_id") != -1) {
				keyword_id_val = window.location.href.split("?")[1].split("&")[2].split("=")[1];
			}
			
			var categories_and_keys;
			//alert(category_id_val);
			//alert(keyword_id_val);
			//alert(user_name_cookie);
			//var user_id = "";
			//alert(user_name_cookie);
			
			if(user_name_cookie != undefined && user_name_cookie != "null") {
				$(".ti_left").html("<span>欢迎光临本站！</span><a href='/shopping/user/page_user/center.html'>"+user_name_cookie+"</a>&nbsp;<a href='JavaScript:void(0);' class='logout_btn' >退出登录</a>");
				$.ajax({
					type:"post",
					url:"/shopping/user/getUserCollection.do",
					data:{"user_name":user_name_cookie},
					success:function(data){
						if(data == "no_user_collection") {
							collectiongoods_id == "";
						} else {
							collectiongoods_id = eval("("+data+")");
						}
					}
				});
				
				$.ajax({
					type:"post",
					url:"/shopping/user/getLogoAndCopyright.do",
					success:function(data){
						LogoAndCopyright_val = eval("("+data+")");
						$(".hi_logo a").attr("style","background: url(/img/"+LogoAndCopyright_val.logo_img+");");
						$(".fi_copy").text(LogoAndCopyright_val.copyright_detail);
					}
				});
				
				
				$.ajax({
					type:"post",
					url:"/shopping/user/getUserCart.do",
					data:{"user_name":user_name_cookie,"from":"index"},
					success:function(data){
						if(data == "no_user_cart") {
							cartgoods_id == "";
						} else {
							cartgoods_id = eval("("+data+")");
						}
					}
				});
				
				
			}
			
			if(user_name_cookie == undefined || user_name_cookie == "null") {
				$(".ti_left").html("<span>欢迎光临本站！</span>"
						 + "<a href='/shopping/user/page_user/login.html?loginfrom=page_goods/index.html'>请登录</a>&nbsp;"
						 + "<a href='/shopping/user/page_user/register.html?regfrom=page_goods/index.html'>免费注册</a>");
			}
			
			$(".logout_btn").on("click", function(){
				$.cookie("user_name_cookie", null,{path: "/"});
				//$.removeCookie("user_name_cookie");
				$(".ti_left").html("<span>欢迎光临本站！</span>"
								 + "<a href='/shopping/user/page_user/login.html?loginfrom=page_goods/index.html'>请登录</a>&nbsp;"
								 + "<a href='/shopping/user/page_user/register.html?regfrom=page_goods/index.html'>免费注册</a>");
			});
			
			$.ajax({
				type:"post",
				url:"/shopping/user/getCatsAndKeys.do",
				success:function(data){
					categories_and_keys = eval("("+data+")");
					var _html = "";
					var flag_category_id = true;
					var flag_keyword_id = true;
					//alert(category_id_val == "");
					//alert(keyword_id_val == "");
					if(window.location.href.indexOf("cat_id") != -1) {
						category_id_val = window.location.href.split("?")[1].split("&")[1].split("=")[1];
					}
					if(window.location.href.indexOf("key_id") != -1) {
						keyword_id_val = window.location.href.split("?")[1].split("&")[2].split("=")[1];
					}
					
					if(category_id_val == ""){
						flag_category_id = false;
					}
					if(keyword_id_val == ""){
						flag_keyword_id = false;
					}
					//alert(window.location.href.indexOf("key_id") != -1);
					if(flag_category_id == false) {
						//alert("category_id_val为空");
						_html += "<tr>"
							   + "<th>主分类</th>"
							   + "<td class='level1'>"
							   + "<a href='/shopping/user/gotoCatsAndKeys.do?search_key_original="+encodeURI(search_key_original_val)+"&search_key="+search_key_val+"&cat_id=no_cat_id' class='a_active'>主分类</a>";
						for (var i = 0; i < categories_and_keys.length; i++) {
							_html += "<a href='/shopping/user/gotoCatsAndKeys.do?search_key_original="+encodeURI(search_key_original_val)+"&search_key="+search_key_val+"&cat_id="+categories_and_keys[i].cat_id+"' class='cat_id_"+categories_and_keys[i].cat_id+"'>"+categories_and_keys[i].cat_name+"</a>";
						}
							_html += "</td>"
						           + "</tr>";
						           _html += "</td>"
							           + "</tr>";
							  	_html += "<tr>"
									   + "<th>子分类</th>"
									   + "<td class='level2'>"
									   + "<a href='JavaScript:void(0);' class='a_active'>子分类</a>";
					} else if(flag_keyword_id == false) {
						category_id_val = window.location.href.split("?")[1].split("&")[1].split("=")[1];
						//alert("keyword_id_val为空");
						_html += "<tr>"
							   + "<th>主分类</th>"
							   + "<td class='level1'>"
							   + "<a href='/shopping/user/gotoCatsAndKeys.do?search_key_original="+encodeURI(search_key_original_val)+"&search_key="+search_key_val+"&cat_id=no_cat_id'>主分类</a>";
						for (var i = 0; i < categories_and_keys.length; i++) {
							if(category_id_val == categories_and_keys[i].cat_id) {
								_html += "<a href='/shopping/user/gotoCatsAndKeys.do?search_key_original="+encodeURI(search_key_original_val)+"&search_key="+search_key_val+"&cat_id="+categories_and_keys[i].cat_id+"'  class='a_active cat_id_"+categories_and_keys[i].cat_id+"'>"+categories_and_keys[i].cat_name+"</a>";
							} else {
								_html += "<a href='/shopping/user/gotoCatsAndKeys.do?search_key_original="+encodeURI(search_key_original_val)+"&search_key="+search_key_val+"&cat_id="+categories_and_keys[i].cat_id+"' class='cat_id_"+categories_and_keys[i].cat_id+"'>"+categories_and_keys[i].cat_name+"</a>";
							}
						}
							_html += "</td>"
						           + "</tr>";
						  	_html += "<tr>"
								   + "<th>子分类</th>"
								   + "<td class='level2'>"
								   + "<a href='JavaScript:void(0);' class='a_active'>子分类</a>";
								   for (var i = 0; i < categories_and_keys.length; i++) {
									   if(category_id_val == categories_and_keys[i].cat_id) {
										  	 for (var j = 0; j < categories_and_keys[i].keys.length; j++) {
													_html += "<a href='/shopping/user/gotoCatsAndKeys.do?search_key_original="+encodeURI(search_key_original_val)+"&search_key="+search_key_val+"&cat_id="+categories_and_keys[i].cat_id+"&key_id="+categories_and_keys[i].keys[j].key_id+"' class='key_id_"+categories_and_keys[i].keys[j].key_id+"'>"+categories_and_keys[i].keys[j].key_name+"</a>";
										 	 }
									  	_html += "</td>"
									      	 + "</tr>";
									   }
									}
					} else {
						//alert("两个都不为空");
						category_id_val = window.location.href.split("?")[1].split("&")[1].split("=")[1];
						keyword_id_val = window.location.href.split("?")[1].split("&")[2].split("=")[1];
						_html += "<tr>"
							   + "<th>主分类</th>"
							   + "<td class='level1'>"
							   + "<a href='/shopping/user/gotoCatsAndKeys.do?search_key_original="+encodeURI(search_key_original_val)+"&search_key="+search_key_val+"&cat_id=no_cat_id'>主分类</a>";
						for (var i = 0; i < categories_and_keys.length; i++) {
							//alert(categories_and_keys[i].keys);
							if(category_id_val == categories_and_keys[i].cat_id) {
								_html += "<a href='/shopping/user/gotoCatsAndKeys.do?search_key_original="+encodeURI(search_key_original_val)+"&search_key="+search_key_val+"&cat_id="+categories_and_keys[i].cat_id+"'  class='a_active cat_id_"+categories_and_keys[i].cat_id+"'>"+categories_and_keys[i].cat_name+"</a>";
							} else {
								_html += "<a href='/shopping/user/gotoCatsAndKeys.do?search_key_original="+encodeURI(search_key_original_val)+"&search_key="+search_key_val+"&cat_id="+categories_and_keys[i].cat_id+"' class='cat_id_"+categories_and_keys[i].cat_id+"'>"+categories_and_keys[i].cat_name+"</a>";
							}
						}
						_html += "</td>"
						       + "</tr>";
						_html += "<tr>"
							   + "<th>子分类</th>"
							   + "<td class='level2'>"
							   + "<a href='JavaScript:void(0);'>子分类</a>";
						for (var i = 0; i < categories_and_keys.length; i++) {
							//alert(category_id_val);
							//alert("category_id_val>>>"+category_id_val+"          "+"categories_and_keys[i].cat_id>>>" +categories_and_keys[i].cat_id);
							if(category_id_val == categories_and_keys[i].cat_id) {
								for (var j = 0; j < categories_and_keys[i].keys.length; j++) {
									if(keyword_id_val == categories_and_keys[i].keys[j].key_id) {
										_html += "<a href='/shopping/user/gotoCatsAndKeys.do?search_key_original="+encodeURI(search_key_original_val)+"&search_key="+search_key_val+"&cat_id="+categories_and_keys[i].cat_id+"&key_id="+categories_and_keys[i].keys[j].key_id+"' class='a_active key_id_"+categories_and_keys[i].keys[j].key_id+"'>"+categories_and_keys[i].keys[j].key_name+"</a>";
									} else {
										_html += "<a href='/shopping/user/gotoCatsAndKeys.do?search_key_original="+encodeURI(search_key_original_val)+"&search_key="+search_key_val+"&cat_id="+categories_and_keys[i].cat_id+"&key_id="+categories_and_keys[i].keys[j].key_id+"' class='key_id_"+categories_and_keys[i].keys[j].key_id+"'>"+categories_and_keys[i].keys[j].key_name+"</a>";
									}
										
								}
								_html += "</td>"
								       + "</tr>";
							}
						}
						
					}
					
					
					
					
					
					
					$(".mi_categray table").html(_html);
					
				}
			});

			$.ajax({
				type:"post",
				url:"/shopping/user/getGoodsChoices.do",
				data:{"search_key":search_key_val,"cat_id":category_id_val,"key_id":keyword_id_val},
				success:function(data) {
					user_search_goodsinfo_choices = eval("("+data+")");
					//alert(user_search_goodsinfo_choices.order_condition);
					if(user_search_goodsinfo_choices.order_condition != undefined) {
						if(user_search_goodsinfo_choices.order_condition == "goods_soldnum" && user_search_goodsinfo_choices.order_direction == "asc") {
							$(".mi_sort span:nth-child(2) a:nth-child(1)").addClass("sort_active");
						} else if(user_search_goodsinfo_choices.order_condition == "goods_soldnum" && user_search_goodsinfo_choices.order_direction == "desc") {
							$(".mi_sort span:nth-child(2) a:nth-child(2)").addClass("sort_active");
						} else if(user_search_goodsinfo_choices.order_condition == "goods_clicknum" && user_search_goodsinfo_choices.order_direction == "asc") {
							$(".mi_sort span:nth-child(2) a:nth-child(3)").addClass("sort_active");
						} else if(user_search_goodsinfo_choices.order_condition == "goods_clicknum" && user_search_goodsinfo_choices.order_direction == "desc") {
							$(".mi_sort span:nth-child(2) a:nth-child(4)").addClass("sort_active");
						} else if(user_search_goodsinfo_choices.order_condition == "goods_commentnum" && user_search_goodsinfo_choices.order_direction == "asc") {
							$(".mi_sort span:nth-child(2) a:nth-child(5)").addClass("sort_active");
						} else if(user_search_goodsinfo_choices.order_condition == "goods_commentnum" && user_search_goodsinfo_choices.order_direction == "desc") {
							$(".mi_sort span:nth-child(2) a:nth-child(6)").addClass("sort_active");
						} else if(user_search_goodsinfo_choices.order_condition == "goods_curprice" && user_search_goodsinfo_choices.order_direction == "asc") {
							$(".mi_sort span:nth-child(2) a:nth-child(7)").addClass("sort_active");
						} else if(user_search_goodsinfo_choices.order_condition == "goods_curprice" && user_search_goodsinfo_choices.order_direction == "desc") {
							$(".mi_sort span:nth-child(2) a:nth-child(8)").addClass("sort_active");
						} 
					}
					
				}
			});
			
			$.ajax({
				type:"post",
				url:"/shopping/user/getCatGoodsInfos.do",
				data:{"search_key":search_key_val,"cat_id":category_id_val,"key_id":keyword_id_val},
			    success:function(data){
			    	var pages = eval("("+data+")");
					var _html = "";
					var flag_collect = false;
					var flag_cart = false;
					for (var j = 0; j < pages.gis.length; j++) {
						flag_collect = false;
						flag_cart = false;
						if(collectiongoods_id != "") {
							collectiongoods_id = collectiongoods_id.toString().split(",");
							for (var g = 0; g < collectiongoods_id.length; g++) {
								//alert(collectiongoods_id[g]);
								if(pages.gis[j].goods_id.toString() == collectiongoods_id[g].toString()) {
									flag_collect = true;
									//return;
								}
							}
						}
						
						for (var x = 0; x < cartgoods_id.length; x++) {
							//alert(cartgoods_id[x]);
							if(pages.gis[j].goods_id.toString() == cartgoods_id[x].toString()) {
								flag_cart = true;
								//return;
							}
						} 
							//alert(floors[i].goodsinfos[j].goods_id == collectiongoods_id[g]);
						
						_html += "<div class='mifc_block'>"
							   + "<dl>"
							   + "<dt>"
							   + "<a href='/shopping/user/page_goods/detail.html?goods_id="+ pages.gis[j].goods_id +"'>"
							   + "<img src='/shopping/goodsImg/"+ pages.gis[j].goods_img.split(",")[0] +"'/>"
							   + "</a>"
						       + "</dt>"
							   + "<dd>"
							   + "<a href='/shopping/user/page_goods/detail.html?goods_id="+ pages.gis[j].goods_id +"'>";
						_html += pages.gis[j].goods_name.substring(0,pages.gis[j].goods_name.indexOf(search_key_val))
							   + "<strong style='color:red;'>"+search_key_val+"</strong>"
							   + pages.gis[j].goods_name.substring(pages.gis[j].goods_name.indexOf(search_key_val)+search_key_val.length)	
							   + "</a>"
							   + "</dd>"
							   + "<dd>"
							   + "<span>已售：<b>"+pages.gis[j].goods_soldnum+"</b>件</span>&nbsp;&nbsp;&nbsp;"
							   + "<span>评价：<strong>"+pages.gis[j].goods_commentnum+"</strong>次</span>"
						       + "</dd>"
						       + "<dd>";
						if(flag_collect == true){
							_html += "<a href='JavaScript:void(0)' class='mifcb_collect_btn goods_id_"+pages.gis[j].goods_id.toString()+" collect_true' style='background:url(/shopping/user/page_goods/img/collect_goods_active.png)  no-repeat 10px center;'>已收</a>";
						} else {
							_html += "<a href='JavaScript:void(0)' class='mifcb_collect_btn goods_id_"+pages.gis[j].goods_id.toString()+" collect_false'>收藏</a>";
						}
						if(flag_cart == true){
							_html += "<a href='JavaScript:void(0)' class='mifcb_addtocart_btn goods_id_"+pages.gis[j].goods_id.toString()+" cart_true' style='background:url(/shopping/user/page_goods/img/add_to_cart_btn_bg_active.png)  no-repeat 10px center;'>已入购物车</a>";
						} else {
							_html += "<a href='JavaScript:void(0)' class='mifcb_addtocart_btn goods_id_"+pages.gis[j].goods_id.toString()+" cart_false'>加入购物车</a>";
						}
						_html += "<div class='space10px'></div>"
						       + "</dd>"
					           + "</dl>"
				               + "</div>";
					} 
					_html += "<div class='clear'></div>";   
					_html += "<div class='mir_page'>"
					       + "<span>当前第&nbsp;<b>"+pages.currentPage+"</b>&nbsp;页，共计&nbsp;<b>"+pages.totalPage+"</b>&nbsp;页</span>"
					       + "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"
					       + "<span>"
						   + "每页显示&nbsp;"
						   + "<select name='page_size' class='page_size'>";
					switch (pages.pageSize) {
					case 2:
						_html += "<option value='2' selected='selected'>2</option>"
						       + "<option value='3'>3</option>"
						  	   + "<option value='5'>5</option>"
						  	   + "<option value='10'>10</option>";
						break;
					case 3:
						_html += "<option value='2'>2</option>"
						       + "<option value='3' selected='selected'>3</option>"
						  	   + "<option value='5'>5</option>"
						  	   + "<option value='10'>10</option>";
						break;
					case 5:
						_html += "<option value='2'>2</option>"
						       + "<option value='3'>3</option>"
						  	   + "<option value='5' selected='selected'>5</option>"
						  	   + "<option value='10'>10</option>";
						break;
					case 10:
						_html += "<option value='2'>2</option>"
						       + "<option value='3'>3</option>"
						  	   + "<option value='5'>5</option>"
						  	   + "<option value='10' selected='selected'>10</option>";
						break;
					default:
						_html += "<option value='2'>2</option>"
						       + "<option value='3'>3</option>"
						  	   + "<option value='5'>5</option>"
						  	   + "<option value='10'>10</option>";
						break;
					}
					_html += "</select>"
						   + "&nbsp;条"
						   + "</span>"
						   + "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"
						   + "<a class='mirp_btn' href='JavaScript:void(0);'>首　页</a>"
						   + "&nbsp;&nbsp;&nbsp;&nbsp;"
						   + "<a class='mirp_btn' href='JavaScript:void(0);'>上一页</a>"
						   + "&nbsp;&nbsp;&nbsp;&nbsp;"
						   + "<a class='mirp_btn' href='JavaScript:void(0);'>下一页</a>"
						   + "&nbsp;&nbsp;&nbsp;&nbsp;"
						   + "<a class='mirp_btn' href='JavaScript:void(0);'>末　页</a>"
						   + "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"
						   + "<span>"
						   + "前往第&nbsp;"
						   + "<select name='toPage' class='toPage'>";
					for (var y = 1; y <= pages.totalPage; y++) {
						if(y == pages.currentPage) {
							_html += "<option value='"+y+"' selected='selected'>"+y+"</option>";
						} else {
							_html += "<option value='"+y+"'>"+y+"</option>";
						}
					}
					_html += "</select>"
						   + "&nbsp;页"
						   + "</span>"
						   + "</div>";
					
					$(".mi_list").html(_html);
			    }
			});
			
			$(".logout_btn").live("click", function(){
				$.cookie("user_name_cookie", null,{path: "/"});
				location.reload();
				//$.removeCookie("user_name_cookie");
				$(".ti_left").html("<span>欢迎光临本站！</span>"
								 + "<a href='/shopping/user/page_user/login.html?loginfrom=page_goods/index.html'>请登录</a>&nbsp;"
								 + "<a href='/shopping/user/page_user/register.html?regfrom=page_goods/index.html'>免费注册</a>");
			});
			
			
			$(".mi_sort span:nth-child(2) a").live("click",function(){
				$obj = $(this);
				//var from = "";
				//alert(category_id_val);
				//alert(keyword_id_val);
				var order_condition_val = "";
				var order_direction_val = "";
				if($obj.text() == "销量↑"){
					order_condition_val = "goods_soldnum";
					order_direction_val = "asc";
				} else if($obj.text() == "销量↓"){
					order_condition_val = "goods_soldnum";
					order_direction_val = "desc";
				} else if($obj.text() == "人气↑"){
					order_condition_val = "goods_clicknum";
					order_direction_val = "asc";
				} else if($obj.text() == "人气↓"){
					order_condition_val = "goods_clicknum";
					order_direction_val = "desc";
				} else if($obj.text() == "评价↑"){
					order_condition_val = "goods_commentnum";
					order_direction_val = "asc";
				} else if($obj.text() == "评价↓"){
					order_condition_val = "goods_commentnum";
					order_direction_val = "desc";
				} else if($obj.text() == "价格↑"){
					order_condition_val = "goods_curprice";
					order_direction_val = "asc";
				} else if($obj.text() == "价格↓"){
					order_condition_val = "goods_curprice";
					order_direction_val = "desc";
				} 
				$.ajax({
					type:"post",
					url:"/shopping/user/sortGoodsInfos.do",
					data:{"search_key":search_key_val,"cat_id":category_id_val,"key_id":keyword_id_val,"order_condition":order_condition_val,"order_direction":order_direction_val},
				    success:function(data){
				    	var pages = eval("("+data+")");
				    	$(".mi_sort span:nth-child(2) .sort_active").removeClass("sort_active");
						$obj.parent().children(".sort_active").removeClass("sort_active");
					    $obj.addClass("sort_active");
						var _html = "";
						var flag_collect = false;
						var flag_cart = false;
						for (var j = 0; j < pages.gis.length; j++) {
							flag_collect = false;
							flag_cart = false;
							if(collectiongoods_id != "") {
								collectiongoods_id = collectiongoods_id.toString().split(",");
								for (var g = 0; g < collectiongoods_id.length; g++) {
									//alert(collectiongoods_id[g]);
									if(pages.gis[j].goods_id.toString() == collectiongoods_id[g].toString()) {
										flag_collect = true;
										//return;
									}
								}
							}
							
							for (var x = 0; x < cartgoods_id.length; x++) {
								//alert(cartgoods_id[x]);
								if(pages.gis[j].goods_id.toString() == cartgoods_id[x].toString()) {
									flag_cart = true;
									//return;
								}
							} 
								//alert(floors[i].goodsinfos[j].goods_id == collectiongoods_id[g]);
							
							_html += "<div class='mifc_block'>"
								   + "<dl>"
								   + "<dt>"
								   + "<a href='/shopping/user/page_goods/detail.html?goods_id="+ pages.gis[j].goods_id +"'>"
								   + "<img src='/shopping/goodsImg/"+ pages.gis[j].goods_img.split(",")[0] +"'/>"
								   + "</a>"
							       + "</dt>"
								   + "<dd>"
								   + "<a href='/shopping/user/page_goods/detail.html?goods_id="+ pages.gis[j].goods_id +"'>";
							_html += pages.gis[j].goods_name.substring(0,pages.gis[j].goods_name.indexOf(search_key_val))
								   + "<strong style='color:red;'>"+search_key_val+"</strong>"
								   + pages.gis[j].goods_name.substring(pages.gis[j].goods_name.indexOf(search_key_val)+search_key_val.length)	
								   + "</a>"
								   + "</dd>"
								   + "<dd>"
								   + "<span>已售：<b>"+pages.gis[j].goods_soldnum+"</b>件</span>&nbsp;&nbsp;&nbsp;"
								   + "<span>评价：<strong>"+pages.gis[j].goods_commentnum+"</strong>次</span>"
							       + "</dd>"
							       + "<dd>";
							if(flag_collect == true){
								_html += "<a href='JavaScript:void(0)' class='mifcb_collect_btn goods_id_"+pages.gis[j].goods_id.toString()+" collect_true' style='background:url(/shopping/user/page_goods/img/collect_goods_active.png)  no-repeat 10px center;'>已收</a>";
							} else {
								_html += "<a href='JavaScript:void(0)' class='mifcb_collect_btn goods_id_"+pages.gis[j].goods_id.toString()+" collect_false'>收藏</a>";
							}
							if(flag_cart == true){
								_html += "<a href='JavaScript:void(0)' class='mifcb_addtocart_btn goods_id_"+pages.gis[j].goods_id.toString()+" cart_true' style='background:url(/shopping/user/page_goods/img/add_to_cart_btn_bg_active.png)  no-repeat 10px center;'>已入购物车</a>";
							} else {
								_html += "<a href='JavaScript:void(0)' class='mifcb_addtocart_btn goods_id_"+pages.gis[j].goods_id.toString()+" cart_false'>加入购物车</a>";
							}
							_html += "<div class='space10px'></div>"
							       + "</dd>"
						           + "</dl>"
					               + "</div>";
						} 
						_html += "<div class='clear'></div>";   
						_html += "<div class='mir_page'>"
						       + "<span>当前第&nbsp;<b>"+pages.currentPage+"</b>&nbsp;页，共计&nbsp;<b>"+pages.totalPage+"</b>&nbsp;页</span>"
						       + "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"
						       + "<span>"
							   + "每页显示&nbsp;"
							   + "<select name='page_size' class='page_size'>";
						switch (pages.pageSize) {
						case 2:
							_html += "<option value='2' selected='selected'>2</option>"
							       + "<option value='3'>3</option>"
							  	   + "<option value='5'>5</option>"
							  	   + "<option value='10'>10</option>";
							break;
						case 3:
							_html += "<option value='2'>2</option>"
							       + "<option value='3' selected='selected'>3</option>"
							  	   + "<option value='5'>5</option>"
							  	   + "<option value='10'>10</option>";
							break;
						case 5:
							_html += "<option value='2'>2</option>"
							       + "<option value='3'>3</option>"
							  	   + "<option value='5' selected='selected'>5</option>"
							  	   + "<option value='10'>10</option>";
							break;
						case 10:
							_html += "<option value='2'>2</option>"
							       + "<option value='3'>3</option>"
							  	   + "<option value='5'>5</option>"
							  	   + "<option value='10' selected='selected'>10</option>";
							break;
						default:
							_html += "<option value='2'>2</option>"
							       + "<option value='3'>3</option>"
							  	   + "<option value='5'>5</option>"
							  	   + "<option value='10'>10</option>";
							break;
						}
						_html += "</select>"
							   + "&nbsp;条"
							   + "</span>"
							   + "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"
							   + "<a class='mirp_btn' href='JavaScript:void(0);'>首　页</a>"
							   + "&nbsp;&nbsp;&nbsp;&nbsp;"
							   + "<a class='mirp_btn' href='JavaScript:void(0);'>上一页</a>"
							   + "&nbsp;&nbsp;&nbsp;&nbsp;"
							   + "<a class='mirp_btn' href='JavaScript:void(0);'>下一页</a>"
							   + "&nbsp;&nbsp;&nbsp;&nbsp;"
							   + "<a class='mirp_btn' href='JavaScript:void(0);'>末　页</a>"
							   + "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"
							   + "<span>"
							   + "前往第&nbsp;"
							   + "<select name='toPage' class='toPage'>";
						for (var y = 1; y <= pages.totalPage; y++) {
							if(y == pages.currentPage) {
								_html += "<option value='"+y+"' selected='selected'>"+y+"</option>";
							} else {
								_html += "<option value='"+y+"'>"+y+"</option>";
							}
						}
						_html += "</select>"
							   + "&nbsp;页"
							   + "</span>"
							   + "</div>";
						
						$(".mi_list").html(_html);
				    }
				});
			});
			
			
			$(".mifcb_collect_btn").live("click",function(){
				var mifcb_collect_btn_class = this.className;
				var collect_msg = "";
				if(user_name_cookie == undefined || user_name_cookie == "null") {
					layer.alert("客官，请先登录才能收藏商品~~", {icon: 5});
				} else {
 					var flag = mifcb_collect_btn_class.split(" ")[2];
 					var goods_id = mifcb_collect_btn_class.split(" ")[1].split("_")[2];
 					//alert($(this).parent().html().split("&nbsp;&nbsp;")[1]);
				 	$.ajax({
						type:"post",
						url:"/shopping/user/collectAndUncollect.do",
						data:{"flag":flag,"goods_id":goods_id,"user_name":user_name_cookie},
						async:false,
						success:function(msg){
							if(msg == "uncollect") {
								collect_msg = "uncollect" ;
							} else {
								collect_msg = "collect" ;
							}
						}
					});
					if(collect_msg == "uncollect") {
						$(this).parent().children(".mifcb_collect_btn").attr("class","mifcb_collect_btn goods_id_"+goods_id+" collect_false");
						$(this).parent().children(".mifcb_collect_btn").attr("style","background: url(/shopping/user/page_goods/img/collect_goods.png) no-repeat 10px center;");
						$(this).parent().children(".mifcb_collect_btn").text("收藏");
						
						//$(this).parent().html("<a href='JavaScript:void(0)' class='mifcb_collect_btn goods_id_"+goods_id+" collect_false' style='background: url(/shopping/user/page_goods/img/collect_goods.png) no-repeat 10px center;'>收藏</a>&nbsp;&nbsp;"
								//+ $(this).parent().html().split("&nbsp;&nbsp;")[1]);
					} else {
						$(this).parent().children(".mifcb_collect_btn").attr("class","mifcb_collect_btn goods_id_"+goods_id+" collect_true");
						$(this).parent().children(".mifcb_collect_btn").attr("style","background: url(/shopping/user/page_goods/img/collect_goods_active.png) no-repeat 10px center;");
						$(this).parent().children(".mifcb_collect_btn").text("已收");
						//$(this).parent().html("<a href='JavaScript:void(0)' class='mifcb_collect_btn goods_id_"+goods_id+" collect_true' style='background: url(/shopping/user/page_goods/img/collect_goods_active.png) no-repeat 10px center;'>已收</a>&nbsp;&nbsp;"
								//+ $(this).parent().html().split("&nbsp;&nbsp;")[1]);
					} 
				}
			}); 
			
			
			
			
		 	$(".mifcb_addtocart_btn").live("click",function(){
				var mifcb_addtocart_btn_class = this.className;
				var cart_msg = "";
				if(user_name_cookie == undefined || user_name_cookie == "null") {
					layer.alert("客官，请先登录才能加入购物车~~", {icon: 5});
				} else {
 					var flag = mifcb_addtocart_btn_class.split(" ")[2];
 					var goods_id = mifcb_addtocart_btn_class.split(" ")[1].split("_")[2];
 					
					$.ajax({
						type:"post",
						url:"/shopping/user/addCartAndRemoveCart.do",
						data:{"flag":flag,"goods_id":goods_id,"user_name":user_name_cookie},
						async:false,
						success:function(msg){
							if(msg == "remove_cart") {
								collect_msg = "remove_cart" ;
							} else {
								collect_msg = "add_cart" ;
							}
						}
					});
					if(collect_msg == "remove_cart") {
						$(this).parent().children(".mifcb_addtocart_btn").attr("class","mifcb_addtocart_btn goods_id_"+goods_id+" cart_false");
						$(this).parent().children(".mifcb_addtocart_btn").attr("style","background:url(/shopping/user/page_goods/img/add_to_cart_btn_bg.png) no-repeat 10px center;");
						$(this).parent().children(".mifcb_addtocart_btn").text("加入购物车");
						//$(this).parent().html($(this).parent().html().split("&nbsp;&nbsp;")[0]+"&nbsp;&nbsp;"
								//+ "<a href='JavaScript:void(0)' class='mifcb_addtocart_btn goods_id_"+goods_id+" cart_false' style='background:url(/shopping/user/page_goods/img/add_to_cart_btn_bg.png) no-repeat 10px center;'>加入购物车</a>");
					} else {
						$(this).parent().children(".mifcb_addtocart_btn").attr("class","mifcb_addtocart_btn goods_id_"+goods_id+" cart_true");
						$(this).parent().children(".mifcb_addtocart_btn").attr("style","background:url(/shopping/user/page_goods/img/add_to_cart_btn_bg_active.png) no-repeat 10px center;");
						$(this).parent().children(".mifcb_addtocart_btn").text("已入购物车");
						//$(this).parent().html($(this).parent().html().split("&nbsp;&nbsp;")[0]+"&nbsp;&nbsp;"
								//+ "<a href='JavaScript:void(0)' class='mifcb_addtocart_btn goods_id_"+goods_id+" cart_true' style='background:url(/shopping/user/page_goods/img/add_to_cart_btn_bg_active.png) no-repeat 10px center;'>已入购物车</a>");
					}
				}
			});  
		 	
		 	$(".page_size").live("change",function(){
	    		var page_size_val = $(".page_size").val();
	    	//	alert(page_size_val);
	    		$.ajax({
	    			type:"post",
	    			url:"/shopping/user/userGoodsInfoUpdatePages.do",
	    			data:{"search_key":search_key_val,"cat_id":category_id_val,"key_id":keyword_id_val,"pageSize_str":page_size_val,"from":"page_size"},
	    			success:function(data){
	    				var pages = eval("("+data+")");
						var _html = "";
						var flag_collect = false;
						var flag_cart = false;
						for (var j = 0; j < pages.gis.length; j++) {
							flag_collect = false;
							flag_cart = false;
							if(collectiongoods_id != "") {
								collectiongoods_id = collectiongoods_id.toString().split(",");
								for (var g = 0; g < collectiongoods_id.length; g++) {
									//alert(collectiongoods_id[g]);
									if(pages.gis[j].goods_id.toString() == collectiongoods_id[g].toString()) {
										flag_collect = true;
										//return;
									}
								}
							}
							
							for (var x = 0; x < cartgoods_id.length; x++) {
								//alert(cartgoods_id[x]);
								if(pages.gis[j].goods_id.toString() == cartgoods_id[x].toString()) {
									flag_cart = true;
									//return;
								}
							} 
								//alert(floors[i].goodsinfos[j].goods_id == collectiongoods_id[g]);
							
							_html += "<div class='mifc_block'>"
								   + "<dl>"
								   + "<dt>"
								   + "<a href='/shopping/user/page_goods/detail.html?goods_id="+ pages.gis[j].goods_id +"'>"
								   + "<img src='/shopping/goodsImg/"+ pages.gis[j].goods_img.split(",")[0] +"'/>"
								   + "</a>"
							       + "</dt>"
								   + "<dd>"
								   + "<a href='/shopping/user/page_goods/detail.html?goods_id="+ pages.gis[j].goods_id +"'>";
							_html += pages.gis[j].goods_name.substring(0,pages.gis[j].goods_name.indexOf(search_key_val))
								   + "<strong style='color:red;'>"+search_key_val+"</strong>"
								   + pages.gis[j].goods_name.substring(pages.gis[j].goods_name.indexOf(search_key_val)+search_key_val.length)	
								   + "</a>"
								   + "</dd>"
								   + "<dd>"
								   + "<span>已售：<b>"+pages.gis[j].goods_soldnum+"</b>件</span>&nbsp;&nbsp;&nbsp;"
								   + "<span>评价：<strong>"+pages.gis[j].goods_commentnum+"</strong>次</span>"
							       + "</dd>"
							       + "<dd>";
							if(flag_collect == true){
								_html += "<a href='JavaScript:void(0)' class='mifcb_collect_btn goods_id_"+pages.gis[j].goods_id.toString()+" collect_true' style='background:url(/shopping/user/page_goods/img/collect_goods_active.png)  no-repeat 10px center;'>已收</a>";
							} else {
								_html += "<a href='JavaScript:void(0)' class='mifcb_collect_btn goods_id_"+pages.gis[j].goods_id.toString()+" collect_false'>收藏</a>";
							}
							if(flag_cart == true){
								_html += "<a href='JavaScript:void(0)' class='mifcb_addtocart_btn goods_id_"+pages.gis[j].goods_id.toString()+" cart_true' style='background:url(/shopping/user/page_goods/img/add_to_cart_btn_bg_active.png)  no-repeat 10px center;'>已入购物车</a>";
							} else {
								_html += "<a href='JavaScript:void(0)' class='mifcb_addtocart_btn goods_id_"+pages.gis[j].goods_id.toString()+" cart_false'>加入购物车</a>";
							}
							_html += "<div class='space10px'></div>"
							       + "</dd>"
						           + "</dl>"
					               + "</div>";
						} 
						_html += "<div class='clear'></div>";   
						_html += "<div class='mir_page'>"
						       + "<span>当前第&nbsp;<b>"+pages.currentPage+"</b>&nbsp;页，共计&nbsp;<b>"+pages.totalPage+"</b>&nbsp;页</span>"
						       + "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"
						       + "<span>"
							   + "每页显示&nbsp;"
							   + "<select name='page_size' class='page_size'>";
						switch (pages.pageSize) {
						case 2:
							_html += "<option value='2' selected='selected'>2</option>"
							       + "<option value='3'>3</option>"
							  	   + "<option value='5'>5</option>"
							  	   + "<option value='10'>10</option>";
							break;
						case 3:
							_html += "<option value='2'>2</option>"
							       + "<option value='3' selected='selected'>3</option>"
							  	   + "<option value='5'>5</option>"
							  	   + "<option value='10'>10</option>";
							break;
						case 5:
							_html += "<option value='2'>2</option>"
							       + "<option value='3'>3</option>"
							  	   + "<option value='5' selected='selected'>5</option>"
							  	   + "<option value='10'>10</option>";
							break;
						case 10:
							_html += "<option value='2'>2</option>"
							       + "<option value='3'>3</option>"
							  	   + "<option value='5'>5</option>"
							  	   + "<option value='10' selected='selected'>10</option>";
							break;
						default:
							_html += "<option value='2'>2</option>"
							       + "<option value='3'>3</option>"
							  	   + "<option value='5'>5</option>"
							  	   + "<option value='10'>10</option>";
							break;
						}
						_html += "</select>"
							   + "&nbsp;条"
							   + "</span>"
							   + "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"
							   + "<a class='mirp_btn' href='JavaScript:void(0);'>首　页</a>"
							   + "&nbsp;&nbsp;&nbsp;&nbsp;"
							   + "<a class='mirp_btn' href='JavaScript:void(0);'>上一页</a>"
							   + "&nbsp;&nbsp;&nbsp;&nbsp;"
							   + "<a class='mirp_btn' href='JavaScript:void(0);'>下一页</a>"
							   + "&nbsp;&nbsp;&nbsp;&nbsp;"
							   + "<a class='mirp_btn' href='JavaScript:void(0);'>末　页</a>"
							   + "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"
							   + "<span>"
							   + "前往第&nbsp;"
							   + "<select name='toPage' class='toPage'>";
						for (var y = 1; y <= pages.totalPage; y++) {
							if(y == pages.currentPage) {
								_html += "<option value='"+y+"' selected='selected'>"+y+"</option>";
							} else {
								_html += "<option value='"+y+"'>"+y+"</option>";
							}
						}
						_html += "</select>"
							   + "&nbsp;页"
							   + "</span>"
							   + "</div>";
						
						$(".mi_list").html(_html);
	    			}
	    		});
	    	});
	    	
	    	$(".mirp_btn").live("click",function(){
	    		var current_page_val = $(this).text();
	    		var current_page_now_val = $(".mir_page span:nth-child(1) b:nth-child(1)").text();
	    		var total_pages_now_val = $(".mir_page span:nth-child(1) b:nth-child(2)").text();
	    		//alert(current_page_now_val);
	    		//alert(total_pages_now_val);
	    		if(current_page_val == "首　页") {
	    			current_page_val = 1;
	    		} else if(current_page_val == "上一页") {
	    			current_page_val = parseInt(current_page_now_val) - 1;
	    		} else if(current_page_val == "下一页") {
	    			current_page_val = parseInt(current_page_now_val) + 1;
	    		} else if(current_page_val == "末　页") {
	    			current_page_val = total_pages_now_val;
	    		} 
	    		if(current_page_val < 1) {
	    			layer.msg("现在已经是首页，没有上一页了~~");
	    		} else if(current_page_val > total_pages_now_val) {
	    			layer.msg("现在已经是末页，没有下一页了~~");
	    		} else {
		    		$.ajax({
		    			type:"post",
		    			url:"/shopping/user/userGoodsInfoUpdatePages.do",
		    			data:{"search_key":search_key_val,"cat_id":category_id_val,"key_id":keyword_id_val,"currentPage_str":current_page_val,"from":"current_page"},
		    			success:function(data){
		    				var pages = eval("("+data+")");
							var _html = "";
							var flag_collect = false;
							var flag_cart = false;
							for (var j = 0; j < pages.gis.length; j++) {
								flag_collect = false;
								flag_cart = false;
								if(collectiongoods_id != "") {
									collectiongoods_id = collectiongoods_id.toString().split(",");
									for (var g = 0; g < collectiongoods_id.length; g++) {
										//alert(collectiongoods_id[g]);
										if(pages.gis[j].goods_id.toString() == collectiongoods_id[g].toString()) {
											flag_collect = true;
											//return;
										}
									}
								}
								
								for (var x = 0; x < cartgoods_id.length; x++) {
									//alert(cartgoods_id[x]);
									if(pages.gis[j].goods_id.toString() == cartgoods_id[x].toString()) {
										flag_cart = true;
										//return;
									}
								} 
									//alert(floors[i].goodsinfos[j].goods_id == collectiongoods_id[g]);
								
								_html += "<div class='mifc_block'>"
									   + "<dl>"
									   + "<dt>"
									   + "<a href='/shopping/user/page_goods/detail.html?goods_id="+ pages.gis[j].goods_id +"'>"
									   + "<img src='/shopping/goodsImg/"+ pages.gis[j].goods_img.split(",")[0] +"'/>"
									   + "</a>"
								       + "</dt>"
									   + "<dd>"
									   + "<a href='/shopping/user/page_goods/detail.html?goods_id="+ pages.gis[j].goods_id +"'>";
								_html += pages.gis[j].goods_name.substring(0,pages.gis[j].goods_name.indexOf(search_key_val))
									   + "<strong style='color:red;'>"+search_key_val+"</strong>"
									   + pages.gis[j].goods_name.substring(pages.gis[j].goods_name.indexOf(search_key_val)+search_key_val.length)	
									   + "</a>"
									   + "</dd>"
									   + "<dd>"
									   + "<span>已售：<b>"+pages.gis[j].goods_soldnum+"</b>件</span>&nbsp;&nbsp;&nbsp;"
									   + "<span>评价：<strong>"+pages.gis[j].goods_commentnum+"</strong>次</span>"
								       + "</dd>"
								       + "<dd>";
								if(flag_collect == true){
									_html += "<a href='JavaScript:void(0)' class='mifcb_collect_btn goods_id_"+pages.gis[j].goods_id.toString()+" collect_true' style='background:url(/shopping/user/page_goods/img/collect_goods_active.png)  no-repeat 10px center;'>已收</a>";
								} else {
									_html += "<a href='JavaScript:void(0)' class='mifcb_collect_btn goods_id_"+pages.gis[j].goods_id.toString()+" collect_false'>收藏</a>";
								}
								if(flag_cart == true){
									_html += "<a href='JavaScript:void(0)' class='mifcb_addtocart_btn goods_id_"+pages.gis[j].goods_id.toString()+" cart_true' style='background:url(/shopping/user/page_goods/img/add_to_cart_btn_bg_active.png)  no-repeat 10px center;'>已入购物车</a>";
								} else {
									_html += "<a href='JavaScript:void(0)' class='mifcb_addtocart_btn goods_id_"+pages.gis[j].goods_id.toString()+" cart_false'>加入购物车</a>";
								}
								_html += "<div class='space10px'></div>"
								       + "</dd>"
							           + "</dl>"
						               + "</div>";
							} 
							_html += "<div class='clear'></div>";   
							_html += "<div class='mir_page'>"
							       + "<span>当前第&nbsp;<b>"+pages.currentPage+"</b>&nbsp;页，共计&nbsp;<b>"+pages.totalPage+"</b>&nbsp;页</span>"
							       + "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"
							       + "<span>"
								   + "每页显示&nbsp;"
								   + "<select name='page_size' class='page_size'>";
							switch (pages.pageSize) {
							case 2:
								_html += "<option value='2' selected='selected'>2</option>"
								       + "<option value='3'>3</option>"
								  	   + "<option value='5'>5</option>"
								  	   + "<option value='10'>10</option>";
								break;
							case 3:
								_html += "<option value='2'>2</option>"
								       + "<option value='3' selected='selected'>3</option>"
								  	   + "<option value='5'>5</option>"
								  	   + "<option value='10'>10</option>";
								break;
							case 5:
								_html += "<option value='2'>2</option>"
								       + "<option value='3'>3</option>"
								  	   + "<option value='5' selected='selected'>5</option>"
								  	   + "<option value='10'>10</option>";
								break;
							case 10:
								_html += "<option value='2'>2</option>"
								       + "<option value='3'>3</option>"
								  	   + "<option value='5'>5</option>"
								  	   + "<option value='10' selected='selected'>10</option>";
								break;
							default:
								_html += "<option value='2'>2</option>"
								       + "<option value='3'>3</option>"
								  	   + "<option value='5'>5</option>"
								  	   + "<option value='10'>10</option>";
								break;
							}
							_html += "</select>"
								   + "&nbsp;条"
								   + "</span>"
								   + "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"
								   + "<a class='mirp_btn' href='JavaScript:void(0);'>首　页</a>"
								   + "&nbsp;&nbsp;&nbsp;&nbsp;"
								   + "<a class='mirp_btn' href='JavaScript:void(0);'>上一页</a>"
								   + "&nbsp;&nbsp;&nbsp;&nbsp;"
								   + "<a class='mirp_btn' href='JavaScript:void(0);'>下一页</a>"
								   + "&nbsp;&nbsp;&nbsp;&nbsp;"
								   + "<a class='mirp_btn' href='JavaScript:void(0);'>末　页</a>"
								   + "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"
								   + "<span>"
								   + "前往第&nbsp;"
								   + "<select name='toPage' class='toPage'>";
							for (var y = 1; y <= pages.totalPage; y++) {
								if(y == pages.currentPage) {
									_html += "<option value='"+y+"' selected='selected'>"+y+"</option>";
								} else {
									_html += "<option value='"+y+"'>"+y+"</option>";
								}
							}
							_html += "</select>"
								   + "&nbsp;页"
								   + "</span>"
								   + "</div>";
							
							$(".mi_list").html(_html);
		    			}
		    		});
	    		}
	    	});
	    	
	    	$(".toPage").live("change",function(){
	    		var current_page_val = $(".toPage").val();
	    		$.ajax({
	    			type:"post",
	    			url:"/shopping/user/userGoodsInfoUpdatePages.do",
	    			data:{"search_key":search_key_val,"cat_id":category_id_val,"key_id":keyword_id_val,"currentPage_str":current_page_val,"from":"current_page"},
	    			success:function(data){
	    				var pages = eval("("+data+")");
						var _html = "";
						var flag_collect = false;
						var flag_cart = false;
						for (var j = 0; j < pages.gis.length; j++) {
							flag_collect = false;
							flag_cart = false;
							if(collectiongoods_id != "") {
								collectiongoods_id = collectiongoods_id.toString().split(",");
								for (var g = 0; g < collectiongoods_id.length; g++) {
									//alert(collectiongoods_id[g]);
									if(pages.gis[j].goods_id.toString() == collectiongoods_id[g].toString()) {
										flag_collect = true;
										//return;
									}
								}
							}
							
							for (var x = 0; x < cartgoods_id.length; x++) {
								//alert(cartgoods_id[x]);
								if(pages.gis[j].goods_id.toString() == cartgoods_id[x].toString()) {
									flag_cart = true;
									//return;
								}
							} 
								//alert(floors[i].goodsinfos[j].goods_id == collectiongoods_id[g]);
							
							_html += "<div class='mifc_block'>"
								   + "<dl>"
								   + "<dt>"
								   + "<a href='/shopping/user/page_goods/detail.html?goods_id="+ pages.gis[j].goods_id +"'>"
								   + "<img src='/shopping/goodsImg/"+ pages.gis[j].goods_img.split(",")[0] +"'/>"
								   + "</a>"
							       + "</dt>"
								   + "<dd>"
								   + "<a href='/shopping/user/page_goods/detail.html?goods_id="+ pages.gis[j].goods_id +"'>";
							_html += pages.gis[j].goods_name.substring(0,pages.gis[j].goods_name.indexOf(search_key_val))
								   + "<strong style='color:red;'>"+search_key_val+"</strong>"
								   + pages.gis[j].goods_name.substring(pages.gis[j].goods_name.indexOf(search_key_val)+search_key_val.length)	
								   + "</a>"
								   + "</dd>"
								   + "<dd>"
								   + "<span>已售：<b>"+pages.gis[j].goods_soldnum+"</b>件</span>&nbsp;&nbsp;&nbsp;"
								   + "<span>评价：<strong>"+pages.gis[j].goods_commentnum+"</strong>次</span>"
							       + "</dd>"
							       + "<dd>";
							if(flag_collect == true){
								_html += "<a href='JavaScript:void(0)' class='mifcb_collect_btn goods_id_"+pages.gis[j].goods_id.toString()+" collect_true' style='background:url(/shopping/user/page_goods/img/collect_goods_active.png)  no-repeat 10px center;'>已收</a>";
							} else {
								_html += "<a href='JavaScript:void(0)' class='mifcb_collect_btn goods_id_"+pages.gis[j].goods_id.toString()+" collect_false'>收藏</a>";
							}
							if(flag_cart == true){
								_html += "<a href='JavaScript:void(0)' class='mifcb_addtocart_btn goods_id_"+pages.gis[j].goods_id.toString()+" cart_true' style='background:url(/shopping/user/page_goods/img/add_to_cart_btn_bg_active.png)  no-repeat 10px center;'>已入购物车</a>";
							} else {
								_html += "<a href='JavaScript:void(0)' class='mifcb_addtocart_btn goods_id_"+pages.gis[j].goods_id.toString()+" cart_false'>加入购物车</a>";
							}
							_html += "<div class='space10px'></div>"
							       + "</dd>"
						           + "</dl>"
					               + "</div>";
						} 
						_html += "<div class='clear'></div>";   
						_html += "<div class='mir_page'>"
						       + "<span>当前第&nbsp;<b>"+pages.currentPage+"</b>&nbsp;页，共计&nbsp;<b>"+pages.totalPage+"</b>&nbsp;页</span>"
						       + "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"
						       + "<span>"
							   + "每页显示&nbsp;"
							   + "<select name='page_size' class='page_size'>";
						switch (pages.pageSize) {
						case 2:
							_html += "<option value='2' selected='selected'>2</option>"
							       + "<option value='3'>3</option>"
							  	   + "<option value='5'>5</option>"
							  	   + "<option value='10'>10</option>";
							break;
						case 3:
							_html += "<option value='2'>2</option>"
							       + "<option value='3' selected='selected'>3</option>"
							  	   + "<option value='5'>5</option>"
							  	   + "<option value='10'>10</option>";
							break;
						case 5:
							_html += "<option value='2'>2</option>"
							       + "<option value='3'>3</option>"
							  	   + "<option value='5' selected='selected'>5</option>"
							  	   + "<option value='10'>10</option>";
							break;
						case 10:
							_html += "<option value='2'>2</option>"
							       + "<option value='3'>3</option>"
							  	   + "<option value='5'>5</option>"
							  	   + "<option value='10' selected='selected'>10</option>";
							break;
						default:
							_html += "<option value='2'>2</option>"
							       + "<option value='3'>3</option>"
							  	   + "<option value='5'>5</option>"
							  	   + "<option value='10'>10</option>";
							break;
						}
						_html += "</select>"
							   + "&nbsp;条"
							   + "</span>"
							   + "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"
							   + "<a class='mirp_btn' href='JavaScript:void(0);'>首　页</a>"
							   + "&nbsp;&nbsp;&nbsp;&nbsp;"
							   + "<a class='mirp_btn' href='JavaScript:void(0);'>上一页</a>"
							   + "&nbsp;&nbsp;&nbsp;&nbsp;"
							   + "<a class='mirp_btn' href='JavaScript:void(0);'>下一页</a>"
							   + "&nbsp;&nbsp;&nbsp;&nbsp;"
							   + "<a class='mirp_btn' href='JavaScript:void(0);'>末　页</a>"
							   + "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"
							   + "<span>"
							   + "前往第&nbsp;"
							   + "<select name='toPage' class='toPage'>";
						for (var y = 1; y <= pages.totalPage; y++) {
							if(y == pages.currentPage) {
								_html += "<option value='"+y+"' selected='selected'>"+y+"</option>";
							} else {
								_html += "<option value='"+y+"'>"+y+"</option>";
							}
						}
						_html += "</select>"
							   + "&nbsp;页"
							   + "</span>"
							   + "</div>";
						
						$(".mi_list").html(_html);
	    			}
	    		});
	    	});
			
		});
		
		</script>
<style type="text/css">
.mir_page{text-align: center;}
.mir_page a.mirp_btn{display: inline-block;border:1px solid #FF0000;padding: 2px 3px;color: #FF0000;
	-moz-border-radius: 2px;
	-webkit-border-radius: 2px;
	border-radius: 2px;
}
.mir_page a.mirp_btn:hover{background: #FF0000;color: #ffffff;}
.mir_page span select.toPage{outline: none;}
</style>
	</body>
</html>
